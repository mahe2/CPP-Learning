/**
 * RAII å‘½åçš„è¯¯è§£ä¸çœŸç›¸
 * 
 * RAII = Resource Acquisition Is Initialization
 * 
 * é—®é¢˜ï¼šåå­—åªæåˆ°"åˆå§‹åŒ–"ï¼Œä¸ºä»€ä¹ˆå¼ºè°ƒçš„æ˜¯"è‡ªåŠ¨é”€æ¯"ï¼Ÿ
 * ç­”æ¡ˆï¼šè¿™æ˜¯ C++ å†å²ä¸Šçš„å‘½åå¤±è¯¯ï¼
 * 
 * æ›´å¥½çš„åå­—åº”è¯¥æ˜¯ï¼š
 * - SBRM (Scope-Bound Resource Management) - ä½œç”¨åŸŸç»‘å®šèµ„æºç®¡ç†
 * - CADRE (Constructor Acquires, Destructor Releases) - æ„é€ è·å–ï¼Œææ„é‡Šæ”¾
 * 
 * ä½† RAII è¿™ä¸ªåå­—å·²ç»æˆä¸ºæ ‡å‡†ï¼Œå¤§å®¶éƒ½åœ¨ç”¨ã€‚
 */

#include <iostream>
#include <string>
#include <memory>
#include <fstream>

using namespace std;

// ============================================
// RAII å‘½åçš„å†å²å’Œè¯¯è§£
// ============================================

void explain_raii_naming() {
    cout << "\n" << string(70, '=') << endl;
    cout << "RAII å‘½åçš„å†å²å’Œè¯¯è§£" << endl;
    cout << string(70, '=') << endl;
    
    cout << R"(
ã€RAII åå­—çš„é—®é¢˜ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

åå­—ï¼šResource Acquisition Is Initialization
ç¿»è¯‘ï¼šèµ„æºè·å–å³åˆå§‹åŒ–

é—®é¢˜ï¼š
  âŒ åå­—åªæåˆ°"åˆå§‹åŒ–"ï¼ˆInitializationï¼‰
  âŒ æ²¡æœ‰æåˆ°"é”€æ¯"ï¼ˆDestructionï¼‰
  âŒ æ²¡æœ‰æåˆ°"è‡ªåŠ¨é‡Šæ”¾"
  âŒ å®¹æ˜“è¯¯è§£ä¸ºåªå…³æ³¨åˆå§‹åŒ–

çœŸç›¸ï¼š
  âœ… RAII çš„æ ¸å¿ƒæ˜¯"è‡ªåŠ¨é”€æ¯"ï¼
  âœ… "åˆå§‹åŒ–"åªæ˜¯æ‰‹æ®µï¼Œ"é”€æ¯"æ‰æ˜¯ç›®çš„
  âœ… RAII æŒ‡çš„æ˜¯æ•´ä¸ªç”Ÿå‘½å‘¨æœŸç®¡ç†

ã€ä¸ºä»€ä¹ˆå«è¿™ä¸ªåå­—ï¼Ÿã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å†å²åŸå› ï¼ˆBjarne Stroustrup çš„è§£é‡Šï¼‰ï¼š

1. å¼ºè°ƒ"ç»‘å®š"å…³ç³»ï¼š
   - èµ„æºè·å–ï¼ˆResource Acquisitionï¼‰
   - ç»‘å®šåˆ°ï¼ˆIsï¼‰
   - å¯¹è±¡åˆå§‹åŒ–ï¼ˆInitializationï¼‰
   
2. æ ¸å¿ƒæ€æƒ³ï¼š
   "å½“ä½ åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä½ å°±è·å–äº†èµ„æº"
   "å› ä¸ºå¯¹è±¡åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨é”€æ¯"
   "å¯¹è±¡é”€æ¯æ—¶ï¼Œèµ„æºä¹Ÿè‡ªåŠ¨é‡Šæ”¾"

3. éšå«çš„é€»è¾‘é“¾ï¼š
   åˆå§‹åŒ– â†’ ç»‘å®šèµ„æº â†’ æ ˆå¯¹è±¡ â†’ è‡ªåŠ¨é”€æ¯ â†’ è‡ªåŠ¨é‡Šæ”¾

ã€æ›´å¥½çš„åå­—ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

åæ¥æå‡ºçš„æ›´å‡†ç¡®çš„åå­—ï¼š

1. SBRM - Scope-Bound Resource Management
   ä½œç”¨åŸŸç»‘å®šèµ„æºç®¡ç†
   âœ… å¼ºè°ƒä½œç”¨åŸŸ
   âœ… å¼ºè°ƒæ•´ä¸ªç®¡ç†è¿‡ç¨‹

2. CADRE - Constructor Acquires, Destructor Releases
   æ„é€ è·å–ï¼Œææ„é‡Šæ”¾
   âœ… æ˜ç¡®æåˆ°æ„é€ å’Œææ„
   âœ… æ¸…æ¥šè¡¨è¾¾å®Œæ•´æµç¨‹

3. RRID - Resource Release Is Destruction
   èµ„æºé‡Šæ”¾å³é”€æ¯
   âœ… å¼ºè°ƒé”€æ¯çš„é‡è¦æ€§

ä½†æ˜¯ï¼š
  - RAII è¿™ä¸ªåå­—å·²ç»ç”¨äº† 30+ å¹´
  - æ•´ä¸ª C++ ç¤¾åŒºéƒ½åœ¨ç”¨
  - æ”¹ä¸äº†äº†ï¼

ã€æ­£ç¡®ç†è§£ RAIIã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

RAII æŒ‡çš„æ˜¯å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

    å¯¹è±¡åˆ›å»ºï¼ˆæ ˆä¸Šï¼‰
         â†“
    æ„é€ å‡½æ•°ï¼šè·å–èµ„æº â† "Initialization" æŒ‡çš„æ˜¯è¿™é‡Œ
         â†“
    ä½¿ç”¨èµ„æº
         â†“
    ç¦»å¼€ä½œç”¨åŸŸ
         â†“
    ææ„å‡½æ•°ï¼šé‡Šæ”¾èµ„æº â† è¿™æ‰æ˜¯ RAII çš„æ ¸å¿ƒï¼
         â†“
    å¯¹è±¡é”€æ¯

æ ¸å¿ƒï¼š
  âœ… èµ„æºçš„ç”Ÿå‘½å‘¨æœŸ = å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ
  âœ… å¯¹è±¡åœ¨æ ˆä¸Šï¼Œè‡ªåŠ¨é”€æ¯
  âœ… å¯¹è±¡é”€æ¯æ—¶ï¼Œè‡ªåŠ¨é‡Šæ”¾èµ„æº

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
)" << endl;
}

// ============================================
// RAII çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ¼”ç¤º
// ============================================

class Resource {
private:
    string name;
    int* data;
    
public:
    // 1ï¸âƒ£ æ„é€ å‡½æ•°ï¼šè·å–èµ„æºï¼ˆ"Initialization"ï¼‰
    Resource(const string& n) : name(n) {
        cout << "\n  1ï¸âƒ£ [æ„é€ ] \"" << name << "\"" << endl;
        cout << "     - å¯¹è±¡åˆå§‹åŒ–" << endl;
        cout << "     - è·å–èµ„æºï¼ˆåˆ†é…å†…å­˜ï¼‰" << endl;
        data = new int[100];
        cout << "     - èµ„æºåœ°å€ï¼š" << (void*)data << endl;
    }
    
    // 2ï¸âƒ£ ææ„å‡½æ•°ï¼šé‡Šæ”¾èµ„æºï¼ˆè¿™æ‰æ˜¯ RAII çš„æ ¸å¿ƒï¼ï¼‰
    ~Resource() {
        cout << "\n  2ï¸âƒ£ [ææ„] \"" << name << "\"" << endl;
        cout << "     - å¯¹è±¡é”€æ¯" << endl;
        cout << "     - é‡Šæ”¾èµ„æºï¼ˆdelete[]ï¼‰" << endl;
        cout << "     - èµ„æºåœ°å€ï¼š" << (void*)data << endl;
        delete[] data;
    }
    
    void use() {
        cout << "\n  âœ… [ä½¿ç”¨] \"" << name << "\" æ­£åœ¨ä½¿ç”¨èµ„æº..." << endl;
    }
};

void demo_raii_lifecycle() {
    cout << "\n" << string(70, '=') << endl;
    cout << "RAII å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ¼”ç¤º" << endl;
    cout << string(70, '=') << endl;
    
    cout << "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" << endl;
    cout << "RAII å®Œæ•´æµç¨‹ï¼š" << endl;
    cout << "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" << endl;
    
    {
        cout << "\n>>> è¿›å…¥ä½œç”¨åŸŸ {" << endl;
        
        Resource res("MyResource");  // æ„é€ ï¼šè·å–èµ„æº
        
        res.use();  // ä½¿ç”¨èµ„æº
        
        cout << "\n>>> å³å°†ç¦»å¼€ä½œç”¨åŸŸ }" << endl;
    }  // ææ„ï¼šé‡Šæ”¾èµ„æºï¼ˆè‡ªåŠ¨ï¼ï¼‰
    
    cout << "\n<<< å·²ç¦»å¼€ä½œç”¨åŸŸ" << endl;
    cout << "\nâœ… èµ„æºå·²è‡ªåŠ¨é‡Šæ”¾ï¼è¿™å°±æ˜¯ RAIIï¼" << endl;
}

// ============================================
// "Initialization" çš„çœŸæ­£å«ä¹‰
// ============================================

void explain_initialization_meaning() {
    cout << "\n" << string(70, '=') << endl;
    cout << "\"Initialization\" çš„çœŸæ­£å«ä¹‰" << endl;
    cout << string(70, '=') << endl;
    
    cout << R"(
ã€"Initialization" ä¸ä»…ä»…æ˜¯"åˆå§‹åŒ–"ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

åœ¨ RAII ä¸­ï¼Œ"Initialization" çš„å«ä¹‰æ˜¯ï¼š

1. å­—é¢æ„æ€ï¼š
   åˆå§‹åŒ–å¯¹è±¡æ—¶ï¼ŒåŒæ—¶è·å–èµ„æº

2. æ·±å±‚å«ä¹‰ï¼š
   "åˆå§‹åŒ–"å»ºç«‹äº†èµ„æºå’Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ç»‘å®šå…³ç³»
   
   Resource res;  â† Initialization
      â†“
   èµ„æºç”Ÿå‘½å‘¨æœŸ = å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
      â†“
   å¯¹è±¡é”€æ¯ â†’ èµ„æºé”€æ¯

3. å…³é”®ç†è§£ï¼š
   âœ… "Initialization" æ˜¯å…¥å£
   âœ… "Destruction" æ˜¯å‡ºå£ï¼ˆè™½ç„¶åå­—æ²¡æï¼‰
   âœ… ä¸¤è€…å…±åŒæ„æˆ RAII

ã€å¯¹æ¯”ï¼šä¼ ç»Ÿèµ„æºç®¡ç†ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä¼ ç»Ÿæ–¹å¼ï¼ˆC é£æ ¼ï¼‰ï¼š
  int* data = malloc(100);      // 1. è·å–èµ„æº
  // ä½¿ç”¨èµ„æº...
  free(data);                   // 2. é‡Šæ”¾èµ„æºï¼ˆæ‰‹åŠ¨ï¼‰
  
  é—®é¢˜ï¼š
    âŒ è·å–å’Œé‡Šæ”¾åˆ†ç¦»
    âŒ å®¹æ˜“å¿˜è®°é‡Šæ”¾
    âŒ å¼‚å¸¸æ—¶ä¸ä¼šé‡Šæ”¾

RAII æ–¹å¼ï¼ˆC++ï¼‰ï¼š
  {
      Resource res;             // 1. Initializationï¼ˆè·å–èµ„æºï¼‰
      // ä½¿ç”¨èµ„æº...
  }                             // 2. Destructionï¼ˆè‡ªåŠ¨é‡Šæ”¾ï¼‰
  
  ä¼˜åŠ¿ï¼š
    âœ… è·å–å’Œé‡Šæ”¾ç»‘å®šåœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸Š
    âœ… ä¸ä¼šå¿˜è®°ï¼ˆç¼–è¯‘å™¨ä¿è¯ï¼‰
    âœ… å¼‚å¸¸å®‰å…¨ï¼ˆæ ˆå±•å¼€ä¼šè°ƒç”¨ææ„ï¼‰

ã€ä¸ºä»€ä¹ˆå¼ºè°ƒ "Initialization"ï¼Ÿã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Bjarne Stroustrup çš„æ„å›¾ï¼š

1. å¼ºè°ƒ"ç»‘å®š"çš„å»ºç«‹ï¼š
   "èµ„æºè·å–"åœ¨"åˆå§‹åŒ–"æ—¶å®Œæˆ
   â†’ èµ„æºå’Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»‘å®š
   â†’ å¯¹è±¡é”€æ¯æ—¶ï¼Œèµ„æºå¿…ç„¶é”€æ¯

2. å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼ï¼š
   ä¼ ç»Ÿï¼šèµ„æºå’Œå¯¹è±¡åˆ†ç¦»
   RAIIï¼šèµ„æºå’Œå¯¹è±¡ç»‘å®šï¼ˆåœ¨åˆå§‹åŒ–æ—¶ï¼‰

3. éšå«è‡ªåŠ¨é”€æ¯ï¼š
   C++ ç¨‹åºå‘˜éƒ½çŸ¥é“ï¼š
   - å¯¹è±¡åœ¨æ ˆä¸Š
   - ç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨é”€æ¯
   - è°ƒç”¨ææ„å‡½æ•°
   
   æ‰€ä»¥"åˆå§‹åŒ–æ—¶ç»‘å®š"éšå«äº†"é”€æ¯æ—¶é‡Šæ”¾"

ä½†æ˜¯ï¼š
  âŒ å¯¹æ–°æ‰‹ä¸å‹å¥½ï¼
  âŒ å®¹æ˜“è¯¯è§£ä¸ºåªå…³æ³¨åˆå§‹åŒ–
  âŒ æ²¡æœ‰æ˜ç¡®æåˆ°è‡ªåŠ¨é”€æ¯

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
)" << endl;
}

// ============================================
// RAII çš„ä¸¤ä¸ªé˜¶æ®µ
// ============================================

class TwoPhaseDemo {
private:
    string name;
    
public:
    // é˜¶æ®µ 1ï¼šAcquisitionï¼ˆè·å–ï¼‰
    TwoPhaseDemo(const string& n) : name(n) {
        cout << "\n  ğŸ”µ é˜¶æ®µ 1ï¼šResource Acquisition Is Initialization" << endl;
        cout << "     åå­—å¼ºè°ƒçš„éƒ¨åˆ†ï¼šåˆå§‹åŒ–æ—¶è·å–èµ„æº" << endl;
        cout << "     å®é™…ï¼šæ„é€ å‡½æ•°æ‰§è¡Œ" << endl;
    }
    
    // é˜¶æ®µ 2ï¼šReleaseï¼ˆé‡Šæ”¾ï¼‰
    ~TwoPhaseDemo() {
        cout << "\n  ğŸ”´ é˜¶æ®µ 2ï¼šResource Release Is Destruction" << endl;
        cout << "     åå­—å¿½ç•¥çš„éƒ¨åˆ†ï¼šé”€æ¯æ—¶é‡Šæ”¾èµ„æº" << endl;
        cout << "     å®é™…ï¼šææ„å‡½æ•°æ‰§è¡Œï¼ˆè¿™æ‰æ˜¯æ ¸å¿ƒï¼ï¼‰" << endl;
    }
};

void demo_two_phases() {
    cout << "\n" << string(70, '=') << endl;
    cout << "RAII çš„ä¸¤ä¸ªé˜¶æ®µ" << endl;
    cout << string(70, '=') << endl;
    
    cout << R"(
ã€RAII å®Œæ•´è¿‡ç¨‹ = ä¸¤ä¸ªé˜¶æ®µã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

é˜¶æ®µ 1ï¼šResource Acquisition Is Initializationï¼ˆåå­—æåˆ°çš„ï¼‰
  - æ„é€ å‡½æ•°æ‰§è¡Œ
  - è·å–èµ„æº
  - å»ºç«‹ç»‘å®šå…³ç³»

é˜¶æ®µ 2ï¼šResource Release Is Destructionï¼ˆåå­—å¿½ç•¥çš„ï¼‰
  - ææ„å‡½æ•°æ‰§è¡Œ
  - é‡Šæ”¾èµ„æº
  - è¿™æ‰æ˜¯ RAII çš„çœŸæ­£ä»·å€¼ï¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
)" << endl;
    
    {
        TwoPhaseDemo obj("å®Œæ•´æ¼”ç¤º");
        cout << "\n  âšª ä¸­é—´ï¼šä½¿ç”¨èµ„æº..." << endl;
    }
    
    cout << "\nâœ… ä¸¤ä¸ªé˜¶æ®µéƒ½å®Œæˆäº†ï¼è¿™æ‰æ˜¯å®Œæ•´çš„ RAIIï¼" << endl;
}

// ============================================
// å®é™…ä¾‹å­ï¼šæ™ºèƒ½æŒ‡é’ˆ
// ============================================

void example_smart_pointer() {
    cout << "\n" << string(70, '=') << endl;
    cout << "å®é™…ä¾‹å­ï¼šunique_ptrï¼ˆRAII çš„å®Œç¾ä½“ç°ï¼‰" << endl;
    cout << string(70, '=') << endl;
    
    cout << R"(
ã€unique_ptr çš„ RAII å®ç°ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç®€åŒ–ç‰ˆå®ç°ï¼š

template<typename T>
class unique_ptr {
private:
    T* ptr;
    
public:
    // é˜¶æ®µ 1ï¼šInitializationï¼ˆè·å–èµ„æºï¼‰
    unique_ptr(T* p) : ptr(p) {
        // "åˆå§‹åŒ–"ï¼šè·å–èµ„æºæŒ‡é’ˆ
        // å»ºç«‹ç»‘å®šï¼šptr çš„ç”Ÿå‘½å‘¨æœŸ = unique_ptr å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ
    }
    
    // é˜¶æ®µ 2ï¼šDestructionï¼ˆé‡Šæ”¾èµ„æºï¼‰
    ~unique_ptr() {
        delete ptr;  // è‡ªåŠ¨é‡Šæ”¾ï¼è¿™æ‰æ˜¯ RAII çš„æ ¸å¿ƒï¼
    }
};

ä½¿ç”¨ï¼š
{
    unique_ptr<int> p(new int(42));  â† Initializationï¼ˆåå­—å¼ºè°ƒçš„ï¼‰
    // ä½¿ç”¨ p...
}  â† Destructionï¼ˆåå­—å¿½ç•¥ä½†æ›´é‡è¦çš„ï¼‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
)" << endl;
    
    cout << "å®é™…æ¼”ç¤ºï¼š" << endl;
    
    {
        cout << "\n>>> åˆ›å»º unique_ptr" << endl;
        auto ptr = make_unique<int>(42);
        cout << "  é˜¶æ®µ 1 å®Œæˆï¼šèµ„æºå·²åˆ†é…ï¼ˆnew intï¼‰" << endl;
        cout << "  æŒ‡é’ˆå€¼ï¼š" << *ptr << endl;
        
        cout << "\n>>> å³å°†ç¦»å¼€ä½œç”¨åŸŸ" << endl;
    }
    
    cout << "  é˜¶æ®µ 2 å®Œæˆï¼šèµ„æºå·²é‡Šæ”¾ï¼ˆdeleteï¼‰" << endl;
    cout << "\nâœ… å®Œæ•´çš„ RAIIï¼šåˆå§‹åŒ– + è‡ªåŠ¨é”€æ¯" << endl;
}

// ============================================
// æ­£ç¡®ç†è§£ RAII
// ============================================

void correct_understanding() {
    cout << "\n" << string(70, '=') << endl;
    cout << "æ­£ç¡®ç†è§£ RAII" << endl;
    cout << string(70, '=') << endl;
    
    cout << R"(
ã€RAII çš„æ­£ç¡®ç†è§£ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

é—®é¢˜ï¼šRAII æ˜¯åªæŒ‡åˆå§‹åŒ–ï¼Œè¿˜æ˜¯æŒ‡æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Ÿ

ç­”æ¡ˆï¼šæŒ‡æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è™½ç„¶åå­—åªæåˆ°"åˆå§‹åŒ–"ï¼Œä½†å®é™…å«ä¹‰æ˜¯ï¼š

  å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç† = è·å– + ä½¿ç”¨ + é‡Šæ”¾

  1. Initializationï¼ˆåˆå§‹åŒ–ï¼‰ï¼š
     - æ„é€ å‡½æ•°è·å–èµ„æº
     - å»ºç«‹èµ„æºå’Œå¯¹è±¡çš„ç»‘å®šå…³ç³»
     
  2. Scopeï¼ˆä½œç”¨åŸŸï¼‰ï¼š
     - ä½¿ç”¨èµ„æº
     
  3. Destructionï¼ˆé”€æ¯ï¼‰ï¼š
     - ç¦»å¼€ä½œç”¨åŸŸ
     - ææ„å‡½æ•°è‡ªåŠ¨é‡Šæ”¾èµ„æº â† è¿™æ‰æ˜¯ RAII çš„æ ¸å¿ƒä»·å€¼ï¼

ã€ä¸ºä»€ä¹ˆåå­—å®¹æ˜“è¯¯å¯¼ï¼Ÿã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. å†å²åŸå› ï¼š
   - 1984 å¹´ Bjarne Stroustrup æå‡º
   - å½“æ—¶å¼ºè°ƒ"è·å–å’Œåˆå§‹åŒ–ç»‘å®š"çš„åˆ›æ–°æ€§
   - æ²¡æœ‰é¢„æ–™åˆ°ä¼šå¼•èµ·è¯¯è§£

2. éšå«å‰æï¼š
   - C++ ç¨‹åºå‘˜éƒ½çŸ¥é“æ ˆå¯¹è±¡ä¼šè‡ªåŠ¨é”€æ¯
   - "åˆå§‹åŒ–æ—¶ç»‘å®š"éšå«äº†"é”€æ¯æ—¶é‡Šæ”¾"
   - ä½†å¯¹æ–°æ‰‹ä¸å‹å¥½

3. å‘½åå¤±è¯¯ï¼š
   - åº”è¯¥å« SBRMï¼ˆä½œç”¨åŸŸç»‘å®šèµ„æºç®¡ç†ï¼‰
   - æˆ– CADREï¼ˆæ„é€ è·å–ï¼Œææ„é‡Šæ”¾ï¼‰
   - ä½†æ”¹ä¸äº†äº†ï¼

ã€è®°å¿†æ–¹æ³•ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æŠŠ RAII ç†è§£ä¸ºï¼š

  Resource Acquisition Is Initialization
  èµ„æºè·å–å³åˆå§‹åŒ–
  
  +
  
  Resource Release Is Destructionï¼ˆéšå«çš„ï¼‰
  èµ„æºé‡Šæ”¾å³é”€æ¯

å®Œæ•´å«ä¹‰ï¼š
  "èµ„æºçš„ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå®Œå…¨ç»‘å®š"
  
  å¯¹è±¡åˆ›å»º â†’ èµ„æºè·å–ï¼ˆæ„é€ ï¼‰
  å¯¹è±¡é”€æ¯ â†’ èµ„æºé‡Šæ”¾ï¼ˆææ„ï¼‰

ã€æ ¸å¿ƒè¦ç‚¹ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. RAII ä¸åªæ˜¯åˆå§‹åŒ–ï¼š
   âœ… RAII = å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
   âœ… åˆå§‹åŒ– + è‡ªåŠ¨é”€æ¯

2. è‡ªåŠ¨é”€æ¯æ‰æ˜¯æ ¸å¿ƒï¼š
   âœ… åˆå§‹åŒ–åªæ˜¯æ‰‹æ®µ
   âœ… è‡ªåŠ¨é”€æ¯æ‰æ˜¯ç›®çš„
   âœ… å¼‚å¸¸å®‰å…¨çš„å…³é”®

3. åå­—æ˜¯å†å²é—ç•™é—®é¢˜ï¼š
   âœ… åå­—ç¡®å®å®¹æ˜“è¯¯å¯¼
   âœ… ä½†æ•´ä¸ªç¤¾åŒºéƒ½åœ¨ç”¨
   âœ… ç†è§£å…¶çœŸæ­£å«ä¹‰å³å¯

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
)" << endl;
}

// ============================================
// Main
// ============================================

int main() {
    cout << "======================================================================" << endl;
    cout << "  RAII å‘½åçš„è¯¯è§£ä¸çœŸç›¸" << endl;
    cout << "  ä¸ºä»€ä¹ˆå« \"Initialization\" ä½†å¼ºè°ƒçš„æ˜¯ \"Destruction\"ï¼Ÿ" << endl;
    cout << "======================================================================" << endl;
    
    explain_raii_naming();
    demo_raii_lifecycle();
    explain_initialization_meaning();
    demo_two_phases();
    example_smart_pointer();
    correct_understanding();
    
    cout << "\n======================================================================" << endl;
    cout << "ç»ˆææ€»ç»“" << endl;
    cout << "======================================================================" << endl;
    
    cout << R"(
ã€RAII æ˜¯åˆå§‹åŒ–ï¼Œè¿˜æ˜¯æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Ÿã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç­”æ¡ˆï¼šæ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

RAII = Resource Acquisition Is Initializationï¼ˆå­—é¢ï¼‰
     + Resource Release Is Destructionï¼ˆéšå«ï¼‰
     = å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

ã€åå­—çš„é—®é¢˜ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ åå­—åªæåˆ°"åˆå§‹åŒ–"
âŒ æ²¡æœ‰æåˆ°"é”€æ¯"
âŒ å®¹æ˜“è¯¯è§£ä¸ºåªå…³æ³¨åˆå§‹åŒ–

âœ… å®é™…å«ä¹‰ï¼šå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
âœ… æ ¸å¿ƒä»·å€¼ï¼šè‡ªåŠ¨é”€æ¯ï¼ˆä¸æ˜¯åˆå§‹åŒ–ï¼‰
âœ… åˆå§‹åŒ–åªæ˜¯å»ºç«‹ç»‘å®šå…³ç³»çš„å…¥å£

ã€å®Œæ•´æµç¨‹ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{
    Resource res;           // 1. Initialization
                           //    - æ„é€ å‡½æ•°
                           //    - è·å–èµ„æº
                           //    - å»ºç«‹ç»‘å®šå…³ç³»
    
    res.use();             // 2. Usage
                           //    - ä½¿ç”¨èµ„æº
    
}                          // 3. Destruction â† æ ¸å¿ƒï¼
                           //    - ç¦»å¼€ä½œç”¨åŸŸ
                           //    - ææ„å‡½æ•°
                           //    - è‡ªåŠ¨é‡Šæ”¾èµ„æº

ã€ä¸ºä»€ä¹ˆå«è¿™ä¸ªåå­—ï¼Ÿã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. å†å²åŸå› ï¼ˆ1984 å¹´ï¼‰
2. å¼ºè°ƒ"ç»‘å®š"çš„å»ºç«‹ï¼ˆåˆå§‹åŒ–æ—¶ï¼‰
3. éšå«è‡ªåŠ¨é”€æ¯ï¼ˆC++ ç¨‹åºå‘˜éƒ½çŸ¥é“ï¼‰
4. å‘½åå¤±è¯¯ï¼ˆä½†æ”¹ä¸äº†ï¼‰

æ›´å¥½çš„åå­—ï¼š
  - SBRMï¼ˆä½œç”¨åŸŸç»‘å®šèµ„æºç®¡ç†ï¼‰
  - CADREï¼ˆæ„é€ è·å–ï¼Œææ„é‡Šæ”¾ï¼‰

ã€è®°å¿†è¦ç‚¹ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. RAII â‰  åªæ˜¯åˆå§‹åŒ–
   RAII = åˆå§‹åŒ– + è‡ªåŠ¨é”€æ¯

2. æ ¸å¿ƒæ˜¯è‡ªåŠ¨é”€æ¯
   - ä¸ä¼šå¿˜è®°é‡Šæ”¾
   - å¼‚å¸¸å®‰å…¨
   - ç¡®å®šæ€§é”€æ¯

3. åˆå§‹åŒ–åªæ˜¯å…¥å£
   - å»ºç«‹ç»‘å®šå…³ç³»
   - èµ„æºç”Ÿå‘½å‘¨æœŸ = å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ

4. åå­—æ˜¯å†å²é—ç•™é—®é¢˜
   - ç†è§£å…¶çœŸæ­£å«ä¹‰
   - ä¸è¦è¢«åå­—è¯¯å¯¼

å£è¯€ï¼š
  "Resource Acquisition Is Initialization"ï¼ˆåå­—ï¼‰
  "Resource Release Is Destruction"ï¼ˆæ ¸å¿ƒï¼‰
  "ä¸¤è€…ç»“åˆ = å®Œæ•´çš„ RAII"

======================================================================
)" << endl;
    
    return 0;
}

/**
 * æœ€ç»ˆæ€»ç»“ï¼š
 * 
 * RAII çš„åå­—ç¡®å®å®¹æ˜“è¯¯å¯¼ï¼
 * 
 * åå­—åªæåˆ°ï¼šResource Acquisition Is Initialization
 * å®é™…å«ä¹‰ï¼šå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆåˆå§‹åŒ– + è‡ªåŠ¨é”€æ¯ï¼‰
 * 
 * ä¸ºä»€ä¹ˆï¼Ÿ
 *   1. å†å²åŸå› ï¼š1984 å¹´æå‡ºï¼Œå¼ºè°ƒ"ç»‘å®š"çš„åˆ›æ–°æ€§
 *   2. éšå«å‰æï¼šC++ ç¨‹åºå‘˜éƒ½çŸ¥é“æ ˆå¯¹è±¡ä¼šè‡ªåŠ¨é”€æ¯
 *   3. å‘½åå¤±è¯¯ï¼šåº”è¯¥å« SBRMï¼Œä½†æ”¹ä¸äº†
 * 
 * æ­£ç¡®ç†è§£ï¼š
 *   RAII = èµ„æºç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸå®Œå…¨ç»‘å®š
 *   åˆå§‹åŒ–ï¼šå»ºç«‹ç»‘å®šå…³ç³»ï¼ˆå…¥å£ï¼‰
 *   é”€æ¯ï¼šè‡ªåŠ¨é‡Šæ”¾èµ„æºï¼ˆæ ¸å¿ƒä»·å€¼ï¼‰
 * 
 * è®°ä½ï¼š
 *   RAII æŒ‡çš„æ˜¯æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä¸åªæ˜¯åˆå§‹åŒ–ï¼
 *   è‡ªåŠ¨é”€æ¯æ‰æ˜¯ RAII çš„æ ¸å¿ƒä»·å€¼ï¼
 */
